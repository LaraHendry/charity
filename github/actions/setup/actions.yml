name: Setup Node Environment
description: Setup Node Environment

outputs:
  cache-key:
    description: "The cache key to use for caching dependencies"

runs:
  using: "composite"
  steps:
    - name: Setup Node
      uses: actions/setup-node@v4
      with:
        node-version: "20"

    - name: Generate cache key
      shell: bash
      id: generate-cache-key
      run: echo "CACHE_KEY=node-modules-${{ runner.os }}-${{ hashFiles('**/package-lock.json') }}" >> $GITHUB_ENV

    - name: Cache Dependencies
      id: cache-deps
      uses: actions/cache@v4
      with:
        path: "node_modules"
        key: ${{ env.CACHE_KEY }}
        restore-keys: |
          node-modules-${{ runner.os }}-

    - name: Install Dependencies
      if: steps.cache-deps.outputs.cache-hit != 'true'
      shell: bash
      run: npm ci

    - name: Set Cache Key
      shell: bash
      id: cache-key
      run: echo "cache-key=${{ env.CACHE_KEY }}" >> $GITHUB_OUTPUT
